#include <cmath>
#include "pedestrian_plugin.hpp"

namespace gazebo {
// extracted from default walking.dae animation

double* PedestrianPlugin::get_walking_pose(double distance) {
  double remainder = std::fmod(distance, walking_dist_factor);
  int index = std::min(static_cast<int>((remainder / walking_dist_factor) * 145), 144);
  return walking_pose[index];
}

double PedestrianPlugin::walking_time_factor = 5.79;
double PedestrianPlugin::walking_dist_factor = 1.37;
double PedestrianPlugin::walking_pose[145][6] = {
  {-0.01188027,0.003772318,1.015285,1.5785367192927917,0.0546899686665238,1.498053778121212},
  {-0.004862895419356792,0.004729832884208577,1.0163210902917916,1.5780966565679726,0.046757198387255824,1.4991053106604704},
  {0.00641700242098534,0.00614542125449506,1.01780066178403,1.57695793595913,0.0362106857761575,1.50033909333399},
  {0.0171833750251217,0.00721829047375062,1.0188902482804,1.57487578716153,0.0302039944139998,1.50052383775885},
  {0.0286242169272748,0.00840405034951855,1.01989785515772,1.57184547666513,0.0261136749257364,1.50102836148466},
  {0.0406402431529787,0.0100314787033298,1.02085704023837,1.56906547496368,0.0226954604389729,1.50299494391524},
  {0.052083389364522,0.0117456884321728,1.02143061020098,1.56669864755438,0.0224754205343732,1.50544824715556},
  {0.0628449824262461,0.0132560183369474,1.02177303207358,1.56401941948389,0.0244903736155644,1.50640333195706},
  {0.0737737691115988,0.0146034322616148,1.02272748889401,1.56240935965692,0.0228174116614474,1.50338276197751},
  {0.0846193744912194,0.0157507400236637,1.0245923103157,1.56069276356666,0.019263004024057,1.49753762017543},
  {0.095302155172397,0.0167884109546489,1.02666708454234,1.55761630492526,0.0145632499876329,1.49310169162306},
  {0.10606222078999,0.0177888688816255,1.02813102920318,1.5543397048942,0.0037497408437223,1.49032746391162},
  {0.116277778052735,0.01861397484154,1.02872263496989,1.55190812655616,-0.00518105049609373,1.48697794052612},
  {0.126079272807493,0.0191606151053847,1.02945145111432,1.54879281747391,-0.0115992340309761,1.48503433769889},
  {0.135686511679358,0.0194736317612632,1.03048464828028,1.54595232778749,-0.0181410822727994,1.48523655960148},
  {0.145680202079597,0.0203114694465123,1.03143503407997,1.5436163966594,-0.0300745065845542,1.48891229048265},
  {0.155721794046343,0.0215003996953704,1.03211663353469,1.54190678771306,-0.0422167411817719,1.49486094020193},
  {0.16522048838855,0.0221303479077012,1.03275223212357,1.54007142568814,-0.0481531678780126,1.49817489205717},
  {0.175162188202809,0.0226595977675698,1.03411627166298,1.53713806286868,-0.050337928409926,1.50054077481708},
  {0.184432067977323,0.0230308976420506,1.03525265395388,1.53440415205624,-0.0487987245012491,1.502582070313},
  {0.193360048440726,0.0234500558683938,1.03583502424004,1.53270618645347,-0.0499510169023339,1.50517962345087},
  {0.202779679991937,0.024010355007692,1.03633022505982,1.53182916196681,-0.0542705242708685,1.50795573603243},
  {0.212089255744294,0.0246487262696363,1.03685822655742,1.53083888981191,-0.0550207946002692,1.51224164478662},
  {0.220988440870155,0.024808699432831,1.03730062028099,1.5292258463973,-0.0525689158836609,1.51753276382363},
  {0.22990045197532,0.0245235099674319,1.0378126284899,1.52707673101465,-0.049387644941467,1.52231710221072},
  {0.239360038476513,0.0246828264353096,1.03831902116783,1.52571282819953,-0.0530619412505861,1.52724179928062},
  {0.249092895972748,0.0252959594427119,1.03849259804157,1.52425133905965,-0.0628432409203798,1.53214557369279},
  {0.258635706991147,0.0257490606191951,1.03831378392973,1.52162159827964,-0.0709287400876772,1.53761478764553},
  {0.267510784630518,0.02572674251806,1.03793457880337,1.52023937238399,-0.0715842598204137,1.54371845314646},
  {0.275555575855624,0.0254991238371812,1.03735496471943,1.52183601817032,-0.0686937465297,1.54971451566951},
  {0.283450091441672,0.0255547429080569,1.03663496040032,1.52414653148439,-0.0687544438463362,1.55588478969594},
  {0.291820070072235,0.0257378052168383,1.03579255081959,1.52503169773907,-0.0694194065915851,1.56110589402557},
  {0.300575254334482,0.0255875527818841,1.03476855397686,1.52467844864614,-0.0669363653332954,1.56458517752046},
  {0.309454554755567,0.0254261504543164,1.03368012419901,1.52407024755745,-0.066240003813069,1.56995771187916},
  {0.31800800089279,0.0254723358168335,1.03224972028224,1.52455550213884,-0.0733228188909769,1.57649850342574},
  {0.326588025094816,0.0252933181836508,1.03066894254308,1.52492776870114,-0.0798218838538655,1.57869575239754},
  {0.336077753214781,0.0252859196306432,1.02941453488372,1.52248653609145,-0.0821233541447451,1.58019502302366},
  {0.345617610655913,0.0256207482964936,1.02826133978928,1.52100170578485,-0.0808543512223921,1.58283008735602},
  {0.35393912983249,0.0255930031118888,1.02704695459127,1.52333754325864,-0.0813794936521125,1.58510658466465},
  {0.361643696212837,0.0250209145498833,1.02600135322917,1.52842119751433,-0.0830562959135422,1.58645063690306},
  {0.370130163191493,0.0246028329034968,1.0251949630403,1.53014729137745,-0.0824545702525952,1.58684327373594},
  {0.379393993080872,0.0246609028389374,1.02445576895385,1.52838844489601,-0.0845334586587782,1.5881508641496},
  {0.388474117112282,0.0247075838326214,1.02403857701723,1.52974789543761,-0.0898286023016608,1.59169465908855},
  {0.397246846022032,0.0247537603549572,1.02336256425949,1.5327038856208,-0.0936346094054854,1.59227482169681},
  {0.406034378121792,0.0245291066769861,1.02306498968008,1.53519779611293,-0.0945233942671523,1.5890993025501},
  {0.414772079959688,0.024285608825661,1.02306500264004,1.53690411307628,-0.0948711352404592,1.58787218382681},
  {0.423946883221735,0.0241120446770826,1.02286978652171,1.53930381833877,-0.0952748088894734,1.58821341567528},
  {0.43347002239664,0.0239335566198667,1.02243705841553,1.5423304875253,-0.09658023222437,1.58715879235553},
  {0.443002171725158,0.0237096673052366,1.02232868259492,1.54472098414822,-0.0958185911545604,1.58525288803408},
  {0.452269320877435,0.0232598201859984,1.02236356147551,1.54753172676193,-0.0921441239070821,1.58197492788189},
  {0.461274001324809,0.0227866729174158,1.02224259053928,1.55215508319103,-0.08869100513083,1.57769796528089},
  {0.470394072471571,0.0225987542168674,1.02177416670667,1.55688233502259,-0.0923381249396416,1.57563992573644},
  {0.479668501288793,0.0223634218223053,1.02107456008352,1.56105411220701,-0.0972817899321629,1.57498406235735},
  {0.48890842304941,0.021918529903041,1.02021535495716,1.56548672835659,-0.0988673673506648,1.57269498393059},
  {0.498285713941836,0.0214632522406753,1.01931976095617,1.56894374854791,-0.0992562917103189,1.56967476618674},
  {0.507932234859725,0.0209678081671344,1.01855896092831,1.57021562761143,-0.100260877181398,1.56791780072386},
  {0.517538142172458,0.0203086595257642,1.01797098195214,1.57124628576387,-0.101549579190032,1.56620245822546},
  {0.526789320073934,0.0194878076088405,1.01743336029376,1.5738915342372,-0.0987092705793356,1.56322398228437},
  {0.535855825231003,0.0185662698579206,1.01638411344709,1.57639962576345,-0.0943936258647971,1.561115466307},
  {0.545302163100292,0.0176348596450431,1.01493430419757,1.57642513769274,-0.0942729194672691,1.56210098602456},
  {0.554950134166962,0.0170471271873943,1.01367592699083,1.57551450499195,-0.0950346673398787,1.56386997984814},
  {0.564508619288652,0.0165476943502046,1.01205830916553,1.57546734021052,-0.0946603245906894,1.56376984670596},
  {0.573568526649385,0.015558942427101,1.01060997883217,1.57647170370894,-0.095367697603485,1.56361858598036},
  {0.582338907027329,0.0140298584764537,1.01021480041281,1.57948214417612,-0.0904147664984007,1.56277826463854},
  {0.591837090095287,0.0129257894600036,1.01021398608011,1.58185181209403,-0.0886380554889457,1.56357578212218},
  {0.602080101595986,0.0120613064787483,1.00997395392037,1.58052007949577,-0.0885624854657599,1.56631254930425},
  {0.612112021340647,0.0111908814421469,1.00905236129311,1.57773210563091,-0.0927017935102575,1.56866313962507},
  {0.622346675877223,0.0102405848353565,1.00810314582633,1.57649418743724,-0.0956810731377897,1.56966876573582},
  {0.633258659608323,0.00903584315544678,1.00725835740514,1.57602295945483,-0.0937131972960527,1.56992389108469},
  {0.644054963157915,0.00754267932301047,1.00674237977296,1.57707926534152,-0.094138794456797,1.57124527128229},
  {0.654378182851736,0.00587760394748545,1.00700802270436,1.57861501835331,-0.0909952830185904,1.5734180021558},
  {0.66479422012864,0.00427062343816434,1.00778564542684,1.57860663836578,-0.0853857975618154,1.57648557700605},
  {0.675935000117622,0.00285116340590598,1.00914886716107,1.57714386941223,-0.0751491119775553,1.57893733396744},
  {0.687165492252689,0.00181558328905961,1.01046446512744,1.57519005999051,-0.0679453921855742,1.57962123360999},
  {0.698307889694485,0.000740789250557747,1.0113412371421,1.57334743505823,-0.0650140735288257,1.5796342498015},
  {0.709452201980008,-0.000473363042914333,1.01210203585572,1.57231250914402,-0.0567568678870221,1.57744507081093},
  {0.72013142730765,-0.00141667914659525,1.01319566658667,1.5733560996199,-0.0460569942072977,1.57440031686121},
  {0.730548666088275,-0.00215391565188303,1.01461568190655,1.57457051979587,-0.0414949313330029,1.57164273605014},
  {0.741550181911338,-0.00306006751585125,1.01602686005712,1.57410155519216,-0.0405671145865196,1.56793621565405},
  {0.753167018842717,-0.00419514100775377,1.01722245221524,1.57245612281603,-0.0381961076586287,1.56307050350842},
  {0.764802332538945,-0.00555961370117908,1.0185080876473,1.5704134396078,-0.0354915055059748,1.55871068044943},
  {0.775932194060043,-0.00714575391736791,1.02008007219142,1.5687114833205,-0.0355763373008768,1.5558475219426},
  {0.786162522361172,-0.00870859100609825,1.02173768933903,1.56785423750469,-0.0370129617107077,1.55348436575041},
  {0.795978197856823,-0.0102427122486869,1.02384014515084,1.56739949638575,-0.0322846762537313,1.55053940536132},
  {0.80622617826337,-0.0118005847512416,1.02621128202174,1.56619971901561,-0.0235811042253106,1.5475186781313},
  {0.81668408959585,-0.01297829363366,1.02780005097682,1.56466093112941,-0.0201100880949546,1.54694898039934},
  {0.827237935294125,-0.0142028903283183,1.02908491655267,1.56439752947211,-0.0166454248847536,1.54740768465578},
  {0.838287420503033,-0.0155806887404898,1.03113330160559,1.56326118400605,-0.00731580929225016,1.54798915651729},
  {0.848564178222067,-0.0168498696851165,1.03315806398503,1.56235340123594,0.00664303472827009,1.54781008110503},
  {0.857754971488236,-0.0177369464751491,1.03464047850817,1.56302265804502,0.0138718142529854,1.54708636404437},
  {0.867470322235821,-0.0188692959593921,1.03599405855953,1.56167529953294,0.0140084341713286,1.54886412513801},
  {0.877915038678109,-0.0203884838058923,1.03716524919001,1.55773513607549,0.0205581258943317,1.54895268398982},
  {0.887228328056457,-0.0216110809537763,1.03795924432391,1.55633957392564,0.0306656096366948,1.54677697077382},
  {0.895796945777234,-0.0222260414075887,1.03827041370869,1.55753078536281,0.0273732203461956,1.54741085471263},
  {0.905276913622309,-0.0228911144375658,1.03874082146543,1.55671582280905,0.025928653289585,1.54789724402116},
  {0.914992155395296,-0.0239927152248848,1.03940003801661,1.55333371565769,0.0356604359453019,1.54569749318136},
  {0.924065262754699,-0.0251079378246575,1.04019764293086,1.55241618650556,0.0417651697338436,1.54365003415717},
  {0.933173275815412,-0.025722418367534,1.04090082914537,1.55239927954351,0.0407519979128832,1.54293896504832},
  {0.942452994052715,-0.0263448590687859,1.04118920712331,1.55274924388515,0.0418554723916013,1.53924642711651},
  {0.951051336546909,-0.0271835523407015,1.0413940127199,1.55297903477431,0.0470863564700298,1.53268460570586},
  {0.959228248461593,-0.0279617458724155,1.04183803398455,1.55314413792678,0.0505405127126619,1.52904487852461},
  {0.96780589514485,-0.028447761553268,1.04211880476156,1.55400580608706,0.0521608345721037,1.52859388836656},
  {0.976908601288793,-0.0286277294484844,1.0418991745986,1.55443893431759,0.0543439501214658,1.52819131358824},
  {0.986062175394801,-0.0290220512926603,1.04115514097826,1.55370799866349,0.0562032378093501,1.52542868779295},
  {0.994857425070211,-0.0297315376614596,1.03994390928072,1.55286386089404,0.0567889592740125,1.5209494677174},
  {1.00342235415077,-0.0302319141555669,1.03873595142439,1.5524090063709,0.0567809850842669,1.51786271059131},
  {1.01196767148274,-0.0304245671492344,1.03780234301349,1.55217014732393,0.0591070924135176,1.5166095743318},
  {1.02034533083737,-0.0305331803974371,1.03667591398469,1.55218048959544,0.0648998094494131,1.51506835425692},
  {1.02879369405045,-0.0307536234780524,1.0354635500036,1.55198356641257,0.0674380708780305,1.51198700427668},
  {1.03751765516248,-0.0310779354778476,1.03457795334325,1.55202457403072,0.0646519650727207,1.50684689315381},
  {1.04591253725971,-0.0311753328722968,1.03363992075263,1.55412182730467,0.0630198332979187,1.50265415127297},
  {1.0542661012312,-0.0310607071819427,1.03243673597811,1.55598891759671,0.0669718224445124,1.50088021769161},
  {1.06302484279748,-0.0312273257236115,1.0313183435895,1.55385784119812,0.0732744942084799,1.4970997070745},
  {1.07150813665492,-0.03135872746778,1.03023673093815,1.55299252164799,0.0789478005116491,1.49181297595167},
  {1.0796601005592,-0.031220061996304,1.02920836436508,1.5552900085456,0.0857677906034805,1.4907268035504},
  {1.08829045504728,-0.0311441308443335,1.02859399327989,1.55816461777508,0.087574711624056,1.48956388795426},
  {1.09739140066243,-0.0309610175145199,1.02845959112946,1.5607341774364,0.0798652073963452,1.48848226229701},
  {1.10594930352558,-0.0308007810046318,1.02757074562603,1.56290173653302,0.0819163529516268,1.48728318667073},
  {1.11438682986536,-0.0312035455446756,1.02686916523868,1.5640079580918,0.0847150836183968,1.48194504775195},
  {1.12337858061731,-0.0313969447976771,1.02633036682187,1.56467513440579,0.0851833709791629,1.47944680590657},
  {1.1323705385557,-0.0312158190863271,1.0258919746562,1.56630438776702,0.0876598917139974,1.47964066619858},
  {1.14145287373701,-0.031014411371829,1.02595600998392,1.56849424487819,0.0888912165010054,1.47973747157978},
  {1.15058496663948,-0.0309682428886862,1.02673846071137,1.5705503187447,0.0910669607265499,1.48051931914064},
  {1.15986696978425,-0.0310455542213263,1.02740483279334,1.57347507306122,0.0920928221431733,1.4809132593401},
  {1.16906048335614,-0.0308207876568987,1.02630389824081,1.57694334628942,0.0906994143393594,1.4824373225137},
  {1.17807853741662,-0.0303550013747409,1.02401784966159,1.57995219278798,0.0897294976904963,1.48489166144102},
  {1.18726497972017,-0.030212664271486,1.02203870060239,1.58162580090579,0.0917037066397826,1.48461084038593},
  {1.1966933126935,-0.0302203104571963,1.02071634142127,1.58236216344543,0.0947727131981161,1.48283126015581},
  {1.20609173954783,-0.0297306538986229,1.0196891437623,1.58439340585252,0.0942266542065722,1.48389738102464},
  {1.21539418604652,-0.0289675294715234,1.01816946331629,1.58724133274475,0.0916060748578825,1.48668848663749},
  {1.22498054911561,-0.0285295572748217,1.01630792132863,1.58829257997846,0.0911553216672855,1.48632746349697},
  {1.23515898814381,-0.0282430410156965,1.01542480161283,1.58811015765954,0.0914326215981279,1.48255965169838},
  {1.24560706170352,-0.0276730763645079,1.01533837972496,1.58867384399906,0.0913255531811431,1.48003508462379},
  {1.25578094727243,-0.0268238944831636,1.01472752581179,1.59054597683073,0.09174912730432,1.48019546632971},
  {1.26552732203715,-0.0260322442015074,1.01346514193827,1.59320210930046,0.0921724011087311,1.47931593603983},
  {1.27521863585093,-0.0255620049465998,1.01247395632035,1.5937931199645,0.0920744845109382,1.47490659230696},
  {1.28501056087552,-0.0251001627086178,1.011693124487,1.5920671612627,0.0904070589606016,1.46923004629679},
  {1.2948829251668,-0.0242691025867616,1.01033711812989,1.592051208863,0.0896195427223334,1.46654098252345},
  {1.30501509251928,-0.0235022185434499,1.00885316768666,1.5919663590277,0.0907985922633809,1.46553230943474},
  {1.31551822305422,-0.0224543694302435,1.00839161057912,1.59294302816654,0.085673314517653,1.46448694876683},
  {1.32626052992848,-0.0210928365036242,1.00857397551961,1.5934407154316,0.0774571846312415,1.46420061609483},
  {1.33685909950561,-0.0200229089847818,1.00808436768588,1.59186831945008,0.077803146680874,1.46252889213862},
  {1.34774264285887,-0.0192438727818171,1.00735555638755,1.5885064481631,0.080642423693385,1.4607065262797},
  {1.35892017135863,-0.0180574155446757,1.00713559118727,1.58653536829505,0.0780123822548492,1.46015962009421},
  {1.37043433974946,-0.016707732477317,1.00760963625018,1.5849610492122,0.0708003960102654,1.45878848429391}
};

}  // namespace gazebo
